!SUBROUTINE USER.ACTION.LIST(Y.LIST)
    PROGRAM USER.ACTION.LIST
    $INSERT GLOBUS.BP I_COMMON
    $INSERT GLOBUS.BP I_EQUATE
    $INSERT GLOBUS.BP I_ENQUIRY.COMMON
    $INSERT GLOBUS.BP I_F.USER
    $INSERT BP I_F.USER.MGT
    $INSERT GLOBUS.BP I_F.COMPANY

    FN.USER.MGT='F.EB.USER.MGT'
    F.USER.MGT=''
    FN.USER.HIS ='F.USER$HIS'
    F.USER.HIS = ''
    FN.COM='F.COMPANY'
    F.COM=''
    Y.TEL.CNT = 0
    Y.DISPO.CNT = 0
    Y.OIBTA.CNT = 0
    Y.BFU.CNT = 0
    NO.OF.CLOSE = 0
    Y.CLOSE.CNT = 0
    CALL OPF(FN.USER.MGT,F.USER.MGT)
    CALL OPF(FN.USER.HIS,F.USER.HIS)
    CALL OPF(FN.COM,F.COM)

    OPEN "USER.PERMISSION.LIST" TO F.USER.PERMISSION.LIST
    ELSE
        CMD = "CREATE.FILE USER.PERMISSION.LIST TYPE=UD"
        EXECUTE CMD
        OPEN "USER.PERMISSION.LIST" TO F.USER.PERMISSION.LIST
        ELSE
            CRT "OPENING OF USER.PERMISSION.LIST FAILED"
        END
    END
    Y.FILE.NAME = 'USER.PERMISSION.LIST':'ALL':'.':TODAY:'.csv'
    Y.FILE.DIR = 'USER.PERMISSION.LIST'
    Y.FILE.PATH = Y.FILE.DIR:'/':Y.FILE.NAME

    SEL.COM = 'SELECT ':FN.COM:' WITH @ID NE AE002...'
    CALL EB.READLIST(SEL.COM,SEL.CNT,'',NO.OF.COM,COM.ERR)
    Y.LIST<-1>= 'BRANCH NAME':'|':'TOTAL ACTIVE USER':'|':'TOTAL CLOSE USER':'|':'TOTAL TELLER PERMISSION':'|':'TOTAL DISPO PERMISSION':'|':'TOTAL OIBTA PERMISSION':'|':'TOTAL BIG FILE PERMISSION'
    FOR I = 1 TO NO.OF.COM
        REMOVE Y.COM.LIST FROM SEL.CNT SETTING Y.POS
        CALL F.READ(FN.COM,Y.COM.LIST,R.COM,F.COM,COM.ERR)
        Y.BR.COM.CODE = RIGHT(Y.COM.LIST,4)
        Y.COM.NAME = R.COM<EB.COM.COMPANY.NAME>
        Y.BR.COM.NAME = Y.COM.NAME:"(":Y.BR.COM.CODE:")"

        NO.OF.REC = 0
        SEL.CMD = 'SELECT ':FN.USER.MGT:' WITH REQUEST.CO.CODE EQ ':Y.COM.LIST
        CALL EB.READLIST(SEL.CMD,SEL.LIST,'',NO.OF.REC,RET.CODE)

        Y.TEL.CNT = 0
        Y.DISPO.CNT = 0
        Y.OIBTA.CNT = 0
        Y.BFU.CNT = 0
        Y.CLOSE.CNT = 0
!DEBUG
        FOR J = 1 TO NO.OF.REC
            REMOVE Y.REQ.ID FROM SEL.LIST SETTING Y.POS.ID
            CALL F.READ(FN.USER.MGT,Y.REQ.ID,R.USER,F.USER.MGT,MGT.ERR)
            Y.TELLER.ID = R.USER<EB.USE61.TELLER>
            Y.OIBTA = R.USER<EB.USE61.OIBTA>
            Y.DISPO = R.USER<EB.USE61.DISPO>
            Y.BIG.FILE.UP = R.USER<EB.USE61.BIG.FILE.UPLOAD>
            Y.REQ.COM.CODE = R.USER<EB.USE61.REQUEST.CO.CODE>
            Y.CLOSE = R.USER<EB.USE61.REQUEST.FOR>

            IF Y.CLOSE NE 'CLOSE' THEN

                IF Y.TELLER.ID THEN
                    Y.TEL.CNT = Y.TEL.CNT + 1
                END
                IF Y.DISPO THEN
                    Y.DISPO.CNT = Y.DISPO.CNT + 1
                END
                IF Y.OIBTA THEN
                    Y.OIBTA.CNT = Y.OIBTA.CNT + 1
                END
                IF Y.BIG.FILE.UP THEN
                    Y.BFU.CNT = Y.BFU.CNT + 1
                END
            END
            ELSE
                Y.CLOSE.CNT = Y.CLOSE.CNT +1
            END
        NEXT J
        Y.ACTIVE.USER = NO.OF.REC - Y.CLOSE.CNT
        Y.LIST<-1>= Y.BR.COM.NAME:'|':Y.ACTIVE.USER:'|':Y.CLOSE.CNT:'|':Y.TEL.CNT:'|':Y.DISPO.CNT:'|':Y.OIBTA.CNT:'|':Y.BFU.CNT

        Y.PROGRESS = MOD(I,5000)
        IF Y.PROGRESS EQ 0 THEN
            Y.PERCENT = I*100/NO.OF.REC
            PRINT DROUND(Y.PERCENT,0):'% IS DONE.'
        END
    NEXT I

    IF NO.OF.COM NE 0 THEN
        PRINT '100% IS DONE.'
    END
    ELSE
        PRINT 'NO RECORD FOUND.'
    END
    CRT "TOTAL RECORDS FOUND : ":NO.OF.COM
    IF NOT(Y.FILE.NAME) THEN
        CRT "NO FILE IS EXISTED, CREATING........."
    END
    ELSE
        WRITE Y.LIST TO F.USER.PERMISSION.LIST,Y.FILE.NAME
        CRT "COMPLETE! PLEASE CHECK FILE ":Y.FILE.NAME:" IN THE DIRECTORY ":Y.FILE.DIR""
    END
    IF DCOUNT(Y.LIST,@FM) EQ 1 THEN
        PRINT 'NO DATA IS FOUND.'
    END
    ELSE
        PRINT (DCOUNT(Y.LIST,@FM)):' DATA IS FOUND.'
    END

END
