*-----------------------------------------------------------------------------
* <Rating>465</Rating>
*-----------------------------------------------------------------------------
    SUBROUTINE URM.AUTO.FIELD.7

    $INSERT GLOBUS.BP I_COMMON
    $INSERT GLOBUS.BP I_EQUATE
    $INSERT GLOBUS.BP I_F.USER
    $INSERT BP I_F.USER.MGT
    GOSUB INIT
    GOSUB OPENFILES
    GOSUB PROCESS
    RETURN


INIT:

    FN.UM = 'F.EB.USER.MGT'
    F.UM = ''

    FN.U='F.USER'
    F.U=''

    Y.UM.ID = ''
    R.UM = ''
    Y.UM.ERR = ''
    RETURN

OPENFILES:
    CALL OPF (FN.UM, F.UM)
    CALL OPF(FN.U, F.U)
    CALL OPF(FN.U,F.U)
    RETURN

PROCESS:


    Y.USER.ID=ID.NEW
    CALL F.READ(FN.U,Y.USER.ID,REC.USER,F.U,ERROR.USER)

    Y.BANK.ID=RIGHT(LEFT(Y.USER.ID,8),6)
    IF REC.USER NE '' THEN
        SEL.CMD="SELECT ":FN.UM:" WITH USER.ID EQ ":Y.USER.ID
    END
    ELSE
        SEL.CMD="SELECT ":FN.UM:" WITH EMP.BANK.ID EQ ":Y.BANK.ID
    END
    CALL EB.READLIST(SEL.CMD,SEL.LIST,"",NO.OF.RECORDS,RET.CODE)
    REMOVE Y.UM.ID FROM SEL.LIST SETTING POS
    CALL F.READ(FN.UM,Y.UM.ID,R.UM,F.UM,Y.UM.ERR)

!Y.SIGN.ON.NAME=LEFT(Y.USER.ID,8)
!R.NEW(EB.USE.SIGN.ON.NAME) = Y.SIGN.ON.NAME
!************ADD NEW BY MONWAR*******************
    IF R.UM<EB.USE61.GENERAL> EQ "YES" THEN
        Y.CNT+=1
    END
    IF R.UM<EB.USE61.TELLER> EQ "YES" THEN
        Y.CNT+=1
    END
    IF R.UM<EB.USE61.ATTRIBUTE2> EQ "YES" THEN
        Y.CNT+=1
    END
!***********************************************

    R.NEW(EB.USE.COMPANY.CODE)<1,1> = R.UM<EB.USE61.REQUEST.CO.CODE>

    IF Y.CNT EQ 3 THEN
        R.NEW(EB.USE.COMPANY.RESTR)<1,1> = R.UM<EB.USE61.REQUEST.CO.CODE>
    END
    ELSE
        FOR I = 1 TO Y.CNT
            R.NEW(EB.USE.COMPANY.RESTR)<1,I> = R.UM<EB.USE61.REQUEST.CO.CODE>
        NEXT I
    END

    CALL MULTI.GET.LOC.REF("USER","EMAIL",Y.EMAIL.POS)
    R.NEW(EB.USE.LOCAL.REF)<1,Y.EMAIL.POS,1> = R.UM<EB.USE61.EMAIL>
    CALL MULTI.GET.LOC.REF("USER","MOBILE.NUMBER",Y.MOBILE.POS)
    R.NEW(EB.USE.LOCAL.REF)<1,Y.MOBILE.POS,1> = R.UM<EB.USE61.MOBILE.NO>
    R.NEW(EB.USE.USER.NAME) = R.UM<EB.USE61.USER.NAME>

    Y.REQUEST.FOR=R.UM<EB.USE61.REQUEST.FOR>
    IF Y.REQUEST.FOR EQ "REOPEN" THEN
        Y.DATE=DATE()
        Y.REQ.DATE=CHANGE(OCONV(Y.DATE,'DYMD'),' ','')

***Y.REQ.DATE=R.UM<EB.USE61.REQUEST.DATE.TIME>
* Y.START.DATE="20":LEFT(Y.REQ.DATE,6)
        Y.START.DATE=Y.REQ.DATE
        Y.PASS.VAL=LEFT(Y.START.DATE,4)+1:RIGHT(Y.START.DATE,4):' M0301'
        R.NEW(EB.USE.PASSWORD.VALIDITY)=Y.PASS.VAL

        Y.EDP=LEFT(Y.START.DATE,4)+3:RIGHT(Y.START.DATE,4)
        R.NEW(EB.USE.END.DATE.PROFILE)=Y.EDP


        Y.PASS.VAL=LEFT(Y.START.DATE,4)+1:RIGHT(Y.START.DATE,4):' M0301'
        R.NEW(EB.USE.PASSWORD.VALIDITY)=Y.PASS.VAL
    END
    ELSE IF Y.REQUEST.FOR EQ "CLOSE" THEN
        Y.EDP=R.UM<EB.USE61.CLOSE.APPLY.DATE>
        Y.DATE=DATE()
        Y.REQ.DATE=CHANGE(OCONV(Y.DATE,'DYMD'),' ','')
        IF Y.EDP LT Y.REQ.DATE THEN
            R.NEW(EB.USE.END.DATE.PROFILE)=Y.REQ.DATE
        END
        ELSE
            R.NEW(EB.USE.END.DATE.PROFILE)=Y.EDP
        END
    END


    IF R.UM<EB.USE61.BIG.FILE.UPLOAD> EQ "YES" AND R.UM<EB.USE61.EMP.ROLE> EQ "OTHER" THEN
        R.NEW(EB.USE.INIT.APPLICATION)="?3"
    END
****************** BELOW UPDATE SIMILAR TO URM....FIELD.5 **********

    ELSE IF R.UM<EB.USE61.BIG.FILE.UPLOAD> EQ "YES" AND R.UM<EB.USE61.EMP.ROLE> EQ "MANAGER" THEN
        R.NEW(EB.USE.INIT.APPLICATION)="?3"
    END
    ELSE IF R.UM<EB.USE61.BIG.FILE.UPLOAD> EQ "NO" AND R.UM<EB.USE61.EMP.ROLE> EQ "MANAGER" THEN
        R.NEW(EB.USE.INIT.APPLICATION)=""
    END
    ELSE IF R.UM<EB.USE61.BIG.FILE.UPLOAD> EQ "YES" AND R.UM<EB.USE61.EMP.ROLE> EQ "SECOND OFFICER" THEN
        R.NEW(EB.USE.INIT.APPLICATION)="?3"
    END
    ELSE IF R.UM<EB.USE61.BIG.FILE.UPLOAD> EQ "NO" AND R.UM<EB.USE61.EMP.ROLE> EQ "SECOND OFFICER" THEN
        R.NEW(EB.USE.INIT.APPLICATION)=""
    END
***************** SAME ABOVE UPDATE TO URM.AUTO.FIELD.5 *************
    ELSE
        R.NEW(EB.USE.INIT.APPLICATION)=""
    END


    R.NEW(EB.USE.ATTRIBUTES)<1,1> = ""
    R.NEW(EB.USE.DISPO.OFFICER)=""
    R.NEW(EB.USE.DISPO.RIGHTS)<1,1> = ""
    IF R.UM<EB.USE61.OIBTA> EQ "YES" THEN
        R.NEW(EB.USE.OTH.BOOK.ACCESS)<1,1> = "INTRBRCOMP"
    END
    ELSE
        R.NEW(EB.USE.OTH.BOOK.ACCESS)<1,1> = ""
    END

    RETURN
END
