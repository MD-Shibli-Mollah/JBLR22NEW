*-----------------------------------------------------------------------------
* <Rating>363</Rating>
*-----------------------------------------------------------------------------
    SUBROUTINE URM.AUTO.FIELD.5

    $INSERT GLOBUS.BP I_COMMON
    $INSERT GLOBUS.BP I_EQUATE
    $INSERT GLOBUS.BP I_F.USER
    $INSERT BP I_F.USER.MGT
    GOSUB INIT
    GOSUB OPENFILES
    GOSUB PROCESS
    RETURN


INIT:

    FN.UM = 'F.EB.USER.MGT'
    F.UM = ''

    FN.U='F.USER'
    F.U=''

    Y.UM.ID = ''
    R.UM = ''
    Y.UM.ERR = ''
    Y.CNT = 0
    RETURN

OPENFILES:
    CALL OPF (FN.UM, F.UM)
    CALL OPF(FN.U, F.U)
    RETURN

PROCESS:

!DEBUG

    Y.USER.ID= ID.NEW


    Y.BANK.ID=RIGHT(LEFT(Y.USER.ID,8),6)

    SEL.CMD="SELECT ":FN.UM:" WITH EMP.BANK.ID EQ ":Y.BANK.ID
    CALL EB.READLIST(SEL.CMD,SEL.LIST,"",NO.OF.RECORDS,RET.CODE)

    REMOVE Y.UM.ID FROM SEL.LIST SETTING POS

    CALL F.READ(FN.UM,Y.UM.ID,R.UM,F.UM,Y.UM.ERR)

    Y.SIGN.ON.NAME=LEFT(Y.USER.ID,8)
!************ADD NEW BY MONWAR*******************
    IF R.UM<EB.USE61.GENERAL> EQ "YES" THEN
        Y.CNT+=1
    END
    IF R.UM<EB.USE61.TELLER> EQ "YES" THEN
        Y.CNT+=1
    END
    IF R.UM<EB.USE61.ATTRIBUTE2> EQ "YES" THEN
        Y.CNT+=1
    END
!***********************************************

    R.NEW(EB.USE.SIGN.ON.NAME) = Y.SIGN.ON.NAME

    R.NEW(EB.USE.COMPANY.CODE)<1,1> = R.UM<EB.USE61.REQUEST.CO.CODE>
    IF Y.CNT EQ 3 THEN
        R.NEW(EB.USE.COMPANY.RESTR)<1,1> = R.UM<EB.USE61.REQUEST.CO.CODE>
    END
    ELSE
        FOR I = 1 TO Y.CNT
            R.NEW(EB.USE.COMPANY.RESTR)<1,I> = R.UM<EB.USE61.REQUEST.CO.CODE>
        NEXT I
    END

    CALL MULTI.GET.LOC.REF("USER","EMAIL",Y.EMAIL.POS)
    R.NEW(EB.USE.LOCAL.REF)<1,Y.EMAIL.POS,1> = R.UM<EB.USE61.EMAIL>

    CALL MULTI.GET.LOC.REF("USER","MOBILE.NUMBER",Y.MOBILE.POS)
    R.NEW(EB.USE.LOCAL.REF)<1,Y.MOBILE.POS,1> = R.UM<EB.USE61.MOBILE.NO>

    CALL GET.LOC.REF("USER","EMP.BANK.ID",Y.BANK.ID.POS)
    R.NEW(EB.USE.LOCAL.REF)<1,Y.BANK.ID.POS> = R.UM<EB.USE61.EMP.BANK.ID>

    R.NEW(EB.USE.USER.NAME) = R.UM<EB.USE61.USER.NAME>


**    Y.START.DATE="20":LEFT(Y.REQ.DATE,6)
**  Y.REQ.DATE=R.UM<EB.USE61.REQUEST.DATE.TIME>
*Y.REQ.DATE = TODAY

    Y.DATE=DATE()
    Y.REQ.DATE=CHANGE(OCONV(Y.DATE,'DYMD'),' ','')
    Y.START.DATE=Y.REQ.DATE
    R.NEW(EB.USE.START.DATE.PROFILE)=Y.START.DATE

    Y.PASS.VAL=LEFT(Y.START.DATE,4)+1:RIGHT(Y.START.DATE,4):' M0301'
    R.NEW(EB.USE.PASSWORD.VALIDITY)=Y.PASS.VAL

    Y.EDP=LEFT(Y.START.DATE,4)+3:RIGHT(Y.START.DATE,4)
    R.NEW(EB.USE.END.DATE.PROFILE)=Y.EDP


    IF R.UM<EB.USE61.BIG.FILE.UPLOAD> EQ "YES" AND R.UM<EB.USE61.EMP.ROLE> EQ "OTHER" THEN
        R.NEW(EB.USE.INIT.APPLICATION)="?3"
    END
    ELSE IF R.UM<EB.USE61.BIG.FILE.UPLOAD> EQ "YES" AND R.UM<EB.USE61.EMP.ROLE> EQ "MANAGER" THEN
        R.NEW(EB.USE.INIT.APPLICATION)="?3"
** BIG-FILE=Y AND MAN=Y = ?8
    END
    ELSE IF R.UM<EB.USE61.BIG.FILE.UPLOAD> EQ "NO" AND R.UM<EB.USE61.EMP.ROLE> EQ "MANAGER" THEN
        R.NEW(EB.USE.INIT.APPLICATION)=""
** BIG-FILE=N AND MAN=Y = ?7
    END
    ELSE IF R.UM<EB.USE61.BIG.FILE.UPLOAD> EQ "YES" AND R.UM<EB.USE61.EMP.ROLE> EQ "SECOND OFFICER" THEN
        R.NEW(EB.USE.INIT.APPLICATION)="?3"
** BIG-FILE=N AND MAN=Y = ?8
    END
    ELSE IF R.UM<EB.USE61.BIG.FILE.UPLOAD> EQ "NO" AND R.UM<EB.USE61.EMP.ROLE> EQ "SECOND OFFICER" THEN
        R.NEW(EB.USE.INIT.APPLICATION)=""
    END
** BIG-FILE=N AND MAN=Y = ?7

    ELSE
        R.NEW(EB.USE.INIT.APPLICATION)=""
    END


    R.NEW(EB.USE.ATTRIBUTES)<1,1> = ""
    R.NEW(EB.USE.DISPO.OFFICER)=""
    R.NEW(EB.USE.DISPO.RIGHTS)<1,1> = ""

    IF R.UM<EB.USE61.OIBTA> EQ "YES" THEN
        R.NEW(EB.USE.OTH.BOOK.ACCESS)<1,1> = "INTRBRCOMP"
    END
    ELSE
        R.NEW(EB.USE.OTH.BOOK.ACCESS)<1,1> = ""
    END



    RETURN


END
