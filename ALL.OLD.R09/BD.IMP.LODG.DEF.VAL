*-----------------------------------------------------------------------------
* <Rating>-30</Rating>
*-----------------------------------------------------------------------------
    SUBROUTINE BD.IMP.LODG.DEF.VAL
!PROGRAM PR.VCR.BTBBILL
*----------------------------------------------------------------------------
*displays the advse ref no when the record opend in a particular format
*----------------------------------------------------------------------------
    $INSERT I_COMMON
    $INSERT I_EQUATE
    $INSERT I_F.LETTER.OF.CREDIT
    $INSERT I_F.DRAWINGS
    $INSERT I_F.COMPANY
    $INSERT I_F.PR.T.BRCODE.SEQ.NO1

    GOSUB INITIALISE
    GOSUB OPENFILES
    GOSUB CHECK.REFNO
    RETURN

INITIALISE:

    FN.LETTER.OF.CREDIT="F.LETTER.OF.CREDIT"
    F.LETTER.OF.CREDIT=""
    FN.PR.T.BRCODE.SEQ.NO="F.PR.T.BRCODE.SEQ.NO1"
    F.PR.T.BRCODE.SEQ.NO=""
    FN.DRAWINGS="F.DRAWINGS"
    F.DRAWINGS=""

    RETURN

OPENFILES:

    CALL OPF(FN.LETTER.OF.CREDIT,F.LETTER.OF.CREDIT)
    CALL OPF(FN.PR.T.BRCODE.SEQ.NO,F.PR.T.BRCODE.SEQ.NO)
    CALL OPF(FN.DRAWINGS,F.DRAWINGS)
    RETURN

CHECK.REFNO:
!DEBUG
    Y.DR.ID =ID.NEW
    Y.LC.ID = Y.DR.ID[1,12]

    CALL F.READ(FN.LETTER.OF.CREDIT,Y.LC.ID,R.LETTER.OF.CREDIT,F.LETTER.OF.CREDIT,Y.ERR)

    CALL GET.LOC.REF("LETTER.OF.CREDIT","JOB.NO",Y.JOB.POS)
    CALL GET.LOC.REF("LETTER.OF.CREDIT","INDENTOR.NAME",Y.IND.NAM)
    CALL GET.LOC.REF("LETTER.OF.CREDIT","INDENTOR.ADDRES",Y.IND.ADD)
    CALL GET.LOC.REF("LETTER.OF.CREDIT","INDENTOR.PR.NO",Y.IND.BNKNO)
    CALL GET.LOC.REF("LETTER.OF.CREDIT","IND.CCIE.PR.NO",Y.IND.NUM)
    CALL GET.LOC.REF("LETTER.OF.CREDIT","TENOR.DAYS",Y.TEN.POS)

    CALL GET.LOC.REF("DRAWINGS","TENOR.DAYS",Y.TEN.NUM)
    CALL GET.LOC.REF("DRAWINGS","JOB.NO",D.JOB.POS)
    CALL GET.LOC.REF("DRAWINGS","INDENTOR.NAME",D.IND.NAM)
    CALL GET.LOC.REF("DRAWINGS","INDENTOR.ADDRES",D.IND.ADD)
    CALL GET.LOC.REF("DRAWINGS","INDENTOR.PR.NO",D.IND.BNKNO)
    CALL GET.LOC.REF("DRAWINGS","IND.CCIE.PR.NO",D.IND.NUM)
    CALL GET.LOC.REF("DRAWINGS","APPL.CUST.NO",Y.IMP.CUS.NO)
    CALL GET.LOC.REF("DRAWINGS","IMPORTER.NAME",D.IMP.POS)
    CALL GET.LOC.REF("DRAWINGS","EXPORTER.NAME",D.EXP.POS)
    CALL GET.LOC.REF("DRAWINGS","BTB.BILL.NO",Y.BILL.POS)
    CALL GET.LOC.REF("DRAWINGS","LC.NO",Y.BTB.LC.NO.POS)
    CALL GET.LOC.REF("DRAWINGS","EXPORT.LC.DATE",Y.BTB.ISS.DT.POS)
    CALL GET.LOC.REF("DRAWINGS","CAT.CODE",D.LC.CATE.POS)

    R.NEW(TF.DR.LOCAL.REF)<1,D.LC.CATE.POS>=R.LETTER.OF.CREDIT<TF.LC.CATEGORY.CODE>
!Y.ADV.NO=R.LETTER.OF.CREDIT<TF.LC.LOCAL.REF><1,Y.ADV.POS>
    Y.ADV.NO=R.LETTER.OF.CREDIT<TF.LC.OLD.LC.NUMBER>
    Y.LC.DATE=R.LETTER.OF.CREDIT<TF.LC.ISSUE.DATE>

    R.NEW(TF.DR.LOCAL.REF)<1,Y.BTB.LC.NO.POS>=Y.ADV.NO
    R.NEW(TF.DR.LOCAL.REF)<1,Y.BTB.ISS.DT.POS>=Y.LC.DATE
    R.NEW(TF.DR.LOCAL.REF)<1,D.JOB.POS>=R.LETTER.OF.CREDIT<TF.LC.LOCAL.REF><1,Y.JOB.POS>
    R.NEW(TF.DR.LOCAL.REF)<1,Y.IMP.CUS.NO> = R.LETTER.OF.CREDIT<TF.LC.APPLICANT.CUSTNO>

    Y.IMP.NAME=R.LETTER.OF.CREDIT<TF.LC.APPLICANT>
    Y.BEN.NAME=R.LETTER.OF.CREDIT<TF.LC.BENEFICIARY>
    R.NEW(TF.DR.LOCAL.REF)<1,D.IMP.POS>=EREPLACE(Y.IMP.NAME,VM,SM)
    R.NEW(TF.DR.LOCAL.REF)<1,D.EXP.POS>=EREPLACE(Y.BEN.NAME,VM,SM)


    RETURN
END
