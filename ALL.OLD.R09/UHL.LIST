*-----------------------------------------------------------------------------
* NOFILE ENQUIRY : ENQUIRY FOR UNAUTHORISED, HOLD, LOCKED LIST
* DEVELOPED BY ALIN BOBY
* REQ BY : Abu Hena Mostofa Zamal (FAGM)
* START DATE: 20160427
* COMPLETION DATE : 20160502
* UPLOAD DATE: 20160502
*-----------------------------------------------------------------------------
** there pending PO,PS, DD, TT collection list


    SUBROUTINE UHL.LIST(Y.RETURN)
**    PROGRAM UHL.LIST

    $INSERT GLOBUS.BP I_COMMON
    $INSERT GLOBUS.BP I_EQUATE
    $INSERT GLOBUS.BP I_F.FUNDS.TRANSFER
    $INSERT JBL.BP I_F.ABL.H.MUL.CR
    $INSERT JBL.BP I_F.ABL.H.MUL.DR
    $INSERT JBL.BP I_F.ABL.H.MUL.MCD
    $INSERT GLOBUS.BP I_F.TELLER
    $INSERT GLOBUS.BP I_F.FT.TXN.TYPE.CONDITION
    $INSERT GLOBUS.BP I_F.TELLER.TRANSACTION
    $INSERT GLOBUS.BP I_F.CHEQUE.COLLECTION

    $INSERT GLOBUS.BP I_ENQUIRY.COMMON

!    DEBUG
    GOSUB STEP1
    GOSUB STEP2
    GOSUB STEP3
    RETURN

STEP1:

**** Initially check TT and FT, then other application



    Y.TODAY=TODAY
    Y.COMPANY=ID.COMPANY

**    Y.TODAY='20160501'
**    Y.COMPANY='BD0010888'

    FN.FT='F.FUNDS.TRANSFER$NAU'
    F.FT=''

**ABL.H.MUL.MCD$NAU

    FN.MCD='F.ABL.H.MUL.MCD$NAU'
    F.MCD=''

    FN.MCR='F.ABL.H.MUL.CR$NAU'
    F.MCR=''

    FN.MDR='F.ABL.H.MUL.DR$NAU'
    F.MDR=''

    FN.FT.TXN='F.FT.TXN.TYPE.CONDITION'
    F.FT.TXN=''


    FN.TXN='F.TELLER.TRANSACTION'
    F.TXN=''

    FN.TT = 'F.TELLER$NAU'
    F.TT = ''

    FN.CC='F.CHEQUE.COLLECTION$NAU'
    F.CC=''


    RETURN

STEP2:

    CALL OPF(FN.FT,F.FT)
    CALL OPF(FN.TT,F.TT)
    CALL OPF(FN.MCD,F.MCD)
    CALL OPF(FN.MCR,F.MCR)
    CALL OPF(FN.MDR,F.MDR)
    CALL OPF(FN.FT.TXN,F.FT.TXN)
    CALL OPF(FN.TXN,F.TXN)
    CALL OPF(FN.CC,F.CC)

    RETURN

STEP3:


    SEL.CMD='SELECT ':FN.FT:' WITH CO.CODE EQ ':Y.COMPANY:' AND DEBIT.VALUE.DATE EQ ':Y.TODAY
    CALL EB.READLIST(SEL.CMD,SEL.LIST,'',NO.OF.REC,ERR)
    LOOP
        REMOVE Y.ID FROM SEL.LIST SETTING POS
    WHILE Y.ID:POS
        CALL F.READ(FN.FT,Y.ID,R.FT.REC,F.FT,Y.ERR)
        Y.TRANS.TYPE = R.FT.REC<FT.TRANSACTION.TYPE>
        Y.DR.ACC=R.FT.REC<FT.DEBIT.ACCT.NO>
        Y.CR.ACC=R.FT.REC<FT.CREDIT.ACCT.NO>
        Y.DR.AMOUNT=R.FT.REC<FT.DEBIT.AMOUNT>
        Y.CR.AMOUNT=Y.DR.AMOUNT
        Y.DR.DATE=R.FT.REC<FT.DEBIT.VALUE.DATE>
        Y.CR.DATE=R.FT.REC<FT.CREDIT.VALUE.DATE>
        Y.REC.STATUS=R.FT.REC<FT.RECORD.STATUS>
        IF Y.REC.STATUS='INAU' THEN
            Y.RECORD.STATUS='UNAUTHORISED'
        END
        ELSE IF Y.REC.STATUS='IHLD' THEN
            Y.RECORD.STATUS='HOLD'
        END
        ELSE IF Y.REC.STATUS='RNAU' THEN
            Y.RECORD.STATUS='REVERSE UNAUTHORISED'
        END
        CALL F.READ(FN.FT.TXN,Y.TRANS.TYPE,R.FT.TXN,F.FT.TXN,Y.ERR1)
        Y.TRANS.DESC=R.FT.TXN<FT6.DESCRIPTION>

**        Y.ARRAY=Y.RECORD.STATUS:'*':Y.ID:'*':Y.TRANS.DESC:'*':Y.DR.ACC:'*':Y.CR.ACC:'*':Y.DR.AMOUNT:'*':Y.DR.DATE:'*':Y.CR.DATE:'*':Y.CR.AMOUNT
        Y.ARRAY<-1>=Y.RECORD.STATUS:'*':Y.ID:'*':Y.TRANS.DESC:'*':Y.DR.ACC:'*':Y.CR.ACC:'*':Y.DR.AMOUNT:'*':Y.DR.DATE:'*':Y.CR.DATE:'*':Y.CR.AMOUNT
**        CRT Y.ARRAY
    REPEAT



    SEL.CMD1='SELECT ':FN.MCR:' WITH CO.CODE EQ ':Y.COMPANY:' AND DEBIT.VALUE.DATE EQ ':Y.TODAY
    CALL EB.READLIST(SEL.CMD1,SEL.LIST1,'',NO.OF.REC,ERR)

**    CRT SEL.LIST1
    LOOP
        REMOVE Y.ID1 FROM SEL.LIST1 SETTING POS
    WHILE Y.ID1:POS
        CALL F.READ(FN.MCR,Y.ID1,R.MCR,F.MCR,Y.ERR.MCR)
        Y.TRANS.TYPE = 'Single Dr Multiple Cr'
        Y.DR.ACC=R.MCR<MULCR.DEBIT.ACCT.NO>
        Y.CR.ACC=R.MCR<MULCR.CREDIT.ACCT.NO>
        Y.DR.AMOUNT=R.MCR<MULCR.DEBIT.AMOUNT>
        Y.CR.AMOUNT=R.MCR<MULCR.CREDIT.AMOUNT>
        Y.DR.DATE=R.MCR<MULCR.DEBIT.VALUE.DATE>
        Y.CR.DATE=Y.DR.DATE
        Y.REC.STATUS=R.MCR<MULCR.RECORD.STATUS>
        IF Y.REC.STATUS='INAU' THEN
            Y.RECORD.STATUS='UNAUTHORISED'
        END
        ELSE IF Y.REC.STATUS='IHLD' THEN
            Y.RECORD.STATUS='HOLD'
        END
        ELSE IF Y.REC.STATUS='RNAU' THEN
            Y.RECORD.STATUS='REVERSE UNAUTHORISED'
        END
**CALL F.READ(FN.FT.TXN,Y.TRANS.TYPE,R.FT.TXN,F.FT.TXN,Y.ERR1)
        Y.TRANS.DESC=Y.TRANS.TYPE

**        Y.ARRAY=Y.RECORD.STATUS:'*':Y.ID1:'*':Y.TRANS.DESC:'*':Y.DR.ACC:'*':Y.CR.ACC:'*':Y.DR.AMOUNT:'*':Y.DR.DATE:'*':Y.CR.DATE:'*':Y.CR.AMOUNT
        Y.ARRAY<-1>=Y.RECORD.STATUS:'*':Y.ID1:'*':Y.TRANS.DESC:'*':Y.DR.ACC:'*':Y.CR.ACC:'*':Y.DR.AMOUNT:'*':Y.DR.DATE:'*':Y.CR.DATE:'*':Y.CR.AMOUNT
**        CRT Y.ARRAY
    REPEAT





    SEL.CMD2='SELECT ':FN.MDR:' WITH CO.CODE EQ ':Y.COMPANY:' AND CREDIT.VALUE.DATE EQ ':Y.TODAY
    CALL EB.READLIST(SEL.CMD2,SEL.LIST2,'',NO.OF.REC,ERR)

    LOOP
        REMOVE Y.ID2 FROM SEL.LIST2 SETTING POS
    WHILE Y.ID2:POS
        CALL F.READ(FN.MDR,Y.ID2,R.MDR,F.MDR,Y.ERR.MDR)
        Y.TRANS.TYPE = 'Single Cr Multiple Dr'
        Y.DR.ACC=R.MDR<MULDR.DEBIT.ACCT.NO>
        Y.CR.ACC=R.MDR<MULDR.CREDIT.ACCT.NO>
        Y.DR.AMOUNT=R.MDR<MULDR.DEBIT.AMOUNT>
        Y.CR.AMOUNT=R.MDR<MULDR.CREDIT.AMOUNT>
        Y.CR.DATE=R.MDR<MULDR.CREDIT.VALUE.DATE>
        Y.DR.DATE=R.MDR<MULDR.DEBIT.VALUE.DATE>
        Y.REC.STATUS=R.MDR<MULDR.RECORD.STATUS>
        IF Y.REC.STATUS='INAU' THEN
            Y.RECORD.STATUS='UNAUTHORISED'
        END
        ELSE IF Y.REC.STATUS='IHLD' THEN
            Y.RECORD.STATUS='HOLD'
        END
        ELSE IF Y.REC.STATUS='RNAU' THEN
            Y.RECORD.STATUS='REVERSE UNAUTHORISED'
        END
        Y.TRANS.DESC=Y.TRANS.TYPE

**        Y.ARRAY=Y.RECORD.STATUS:'*':Y.ID2:'*':Y.TRANS.DESC:'*':Y.DR.ACC:'*':Y.CR.ACC:'*':Y.DR.AMOUNT:'*':Y.DR.DATE:'*':Y.CR.DATE:'*':Y.CR.AMOUNT
        Y.ARRAY<-1>=Y.RECORD.STATUS:'*':Y.ID2:'*':Y.TRANS.DESC:'*':Y.DR.ACC:'*':Y.CR.ACC:'*':Y.DR.AMOUNT:'*':Y.DR.DATE:'*':Y.CR.DATE:'*':Y.CR.AMOUNT
**        CRT Y.ARRAY
    REPEAT









    SEL.CMD3='SELECT ':FN.MCD:' WITH CO.CODE EQ ':Y.COMPANY:' AND DEBIT.VALUE.DATE LIKE ...':Y.TODAY:'...'
    CALL EB.READLIST(SEL.CMD3,SEL.LIST3,'',NO.OF.REC,ERR)

    LOOP
        REMOVE Y.ID3 FROM SEL.LIST3 SETTING POS
    WHILE Y.ID3:POS
        CALL F.READ(FN.MCD,Y.ID3,R.MCD,F.MCD,Y.ERR.MCD)
        Y.TRANS.TYPE = 'Multiple Dr Multiple Cr'
        Y.DR.ACC=R.MCD<MCD.DEBIT.ACCT.NO>
        Y.CR.ACC=R.MCD<MCD.CREDIT.ACCT.NO>
        Y.DR.AMOUNT=R.MCD<MCD.DEBIT.AMOUNT>
        Y.CR.AMOUNT=R.MCD<MCD.CREDIT.AMOUNT>
        Y.CR.DATE=R.MCD<MCD.CREDIT.VALUE.DATE>
        Y.DR.DATE=R.MCD<MCD.DEBIT.VALUE.DATE>
        Y.REC.STATUS=R.MCD<MCD.RECORD.STATUS>
        IF Y.REC.STATUS='INAU' THEN
            Y.RECORD.STATUS='UNAUTHORISED'
        END
        ELSE IF Y.REC.STATUS='IHLD' THEN
            Y.RECORD.STATUS='HOLD'
        END
        ELSE IF Y.REC.STATUS='RNAU' THEN
            Y.RECORD.STATUS='REVERSE UNAUTHORISED'
        END
        Y.TRANS.DESC=Y.TRANS.TYPE

**        Y.ARRAY=Y.RECORD.STATUS:'*':Y.ID3:'*':Y.TRANS.DESC:'*':Y.DR.ACC:'*':Y.CR.ACC:'*':Y.DR.AMOUNT:'*':Y.DR.DATE:'*':Y.CR.DATE:'*':Y.CR.AMOUNT
        Y.ARRAY<-1>=Y.RECORD.STATUS:'*':Y.ID3:'*':Y.TRANS.DESC:'*':Y.DR.ACC:'*':Y.CR.ACC:'*':Y.DR.AMOUNT:'*':Y.DR.DATE:'*':Y.CR.DATE:'*':Y.CR.AMOUNT
**         CRT Y.ARRAY
    REPEAT




    SEL.CMD4='SELECT ':FN.TT:' WITH CO.CODE EQ ':Y.COMPANY:' AND VALUE.DATE.1 EQ ':Y.TODAY
    CALL EB.READLIST(SEL.CMD4,SEL.LIST4,'',NO.OF.REC,ERR)

**   CRT SEL.LIST4

    LOOP
        REMOVE Y.ID4 FROM SEL.LIST4 SETTING POS
    WHILE Y.ID4:POS
        CALL F.READ(FN.TT,Y.ID4,R.TT,F.TT,Y.ERR.TT)
        Y.TRANS.CODE = R.TT<TT.TE.TRANSACTION.CODE>
        Y.MARKER=R.TT<TT.TE.DR.CR.MARKER>
        IF Y.MARKER EQ 'DEBIT' THEN
            Y.DR.ACC=R.TT<TT.TE.ACCOUNT.1>
            Y.DR.AMOUNT=R.TT<TT.TE.AMOUNT.LOCAL.1>
            Y.DR.DATE=R.TT<TT.TE.VALUE.DATE.1>
            Y.CR.ACC=R.TT<TT.TE.ACCOUNT.2>
            Y.CR.AMOUNT=R.TT<TT.TE.AMOUNT.LOCAL.2>
            Y.CR.DATE=R.TT<TT.TE.VALUE.DATE.2>
        END
        ELSE IF Y.MARKER EQ 'CREDIT' THEN
            Y.DR.ACC=R.TT<TT.TE.ACCOUNT.2>
            Y.DR.AMOUNT=R.TT<TT.TE.AMOUNT.LOCAL.2>
            Y.DR.DATE=R.TT<TT.TE.VALUE.DATE.2>
            Y.CR.ACC=R.TT<TT.TE.ACCOUNT.1>
            Y.CR.AMOUNT=R.TT<TT.TE.AMOUNT.LOCAL.1>
            Y.CR.DATE=R.TT<TT.TE.VALUE.DATE.1>
        END
        Y.REC.STATUS=R.TT<TT.TE.RECORD.STATUS>
        IF Y.REC.STATUS='INAU' THEN
            Y.RECORD.STATUS='UNAUTHORISED'
        END
        ELSE IF Y.REC.STATUS='IHLD' THEN
            Y.RECORD.STATUS='HOLD'
        END
        ELSE IF Y.REC.STATUS='RNAU' THEN
            Y.RECORD.STATUS='REVERSE UNAUTHORISED'
        END


        CALL F.READ(FN.TXN,Y.TRANS.CODE,R.TXN,F.TXN,Y.ERR1)
        Y.TRANS.DESC=R.TXN<TT.TR.DESC>

**        Y.ARRAY=Y.RECORD.STATUS:'*':Y.ID4:'*':Y.TRANS.DESC:'*':Y.DR.ACC:'*':Y.CR.ACC:'*':Y.DR.AMOUNT:'*':Y.DR.DATE:'*':Y.CR.DATE:'*':Y.CR.AMOUNT
        Y.ARRAY<-1>=Y.RECORD.STATUS:'*':Y.ID4:'*':Y.TRANS.DESC:'*':Y.DR.ACC:'*':Y.CR.ACC:'*':Y.DR.AMOUNT:'*':Y.DR.DATE:'*':Y.CR.DATE:'*':Y.CR.AMOUNT
**        CRT Y.ARRAY
    REPEAT





    SEL.CMD5='SELECT ':FN.CC:' WITH CO.CODE EQ ':Y.COMPANY:' AND ORIG.VALUE.DATE LIKE ...':Y.TODAY:'...'
    CALL EB.READLIST(SEL.CMD5,SEL.LIST5,'',NO.OF.REC,ERR5)

    LOOP
        REMOVE Y.ID5 FROM SEL.LIST5 SETTING POS
    WHILE Y.ID5:POS
        CALL F.READ(FN.CC,Y.ID5,R.CC,F.CC,Y.ERR.CC)

        Y.CHQ.COLL.STATUS=R.CC<CHQ.COL.LOCAL.REF>
        IF Y.CHQ.COLL.STATUS NE '' THEN
            Y.TRANS.TYPE='Cheque Collection : ':Y.CHQ.COLL.STATUS
        END
        ELSE
            Y.CHQ.STATUS=R.CC<CHQ.COL.CHQ.STATUS>
            Y.TRANS.TYPE = 'Cheque Collection : ':Y.CHQ.STATUS
        END
        Y.DR.ACC=R.CC<CHQ.COL.SUSP.POSTED.TO>
        Y.CR.ACC=R.CC<CHQ.COL.CREDIT.ACC.NO>
        Y.DR.AMOUNT=R.CC<CHQ.COL.AMOUNT>
        Y.CR.AMOUNT=Y.DR.AMOUNT
        Y.CR.DATE=R.CC<CHQ.COL.ORIG.VALUE.DATE>
        Y.DR.DATE=R.CC<CHQ.COL.EXPOSURE.DATE>
        Y.REC.STATUS=R.CC<CHQ.COL.RECORD.STATUS>
        IF Y.REC.STATUS='INAU' THEN
            Y.RECORD.STATUS='UNAUTHORISED'
        END
        ELSE IF Y.REC.STATUS='IHLD' THEN
            Y.RECORD.STATUS='HOLD'
        END
        ELSE IF Y.REC.STATUS='RNAU' THEN
            Y.RECORD.STATUS='REVERSE UNAUTHORISED'
        END
        Y.TRANS.DESC=Y.TRANS.TYPE

**        Y.ARRAY=Y.RECORD.STATUS:'*':Y.ID5:'*':Y.TRANS.DESC:'*':Y.DR.ACC:'*':Y.CR.ACC:'*':Y.DR.AMOUNT:'*':Y.DR.DATE:'*':Y.CR.DATE:'*':Y.CR.AMOUNT
        Y.ARRAY<-1>=Y.RECORD.STATUS:'*':Y.ID5:'*':Y.TRANS.DESC:'*':Y.DR.ACC:'*':Y.CR.ACC:'*':Y.DR.AMOUNT:'*':Y.DR.DATE:'*':Y.CR.DATE:'*':Y.CR.AMOUNT
**         CRT Y.ARRAY
    REPEAT





**   Y.RETURN=SORT(Y.ARRAY)
    Y.RETURN=Y.ARRAY
** CRT Y.RETURN

    RETURN

END
