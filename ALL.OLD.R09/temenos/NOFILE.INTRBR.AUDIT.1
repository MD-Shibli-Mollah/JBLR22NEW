***********************************************************
* DEV: ALIN BOBY
* DATE: 20160223
* UPDATE: 20160306
* UPDATE: 20160308 UPLOAD:20160321
* REQ: Abu Hena Mostofa Zamal (FAGM)
* REPORT: INTER BRANCH TRANSACTION PERMISSION AUDIT REPORT (PART - 2)
***********************************************************
    SUBROUTINE NOFILE.INTRBR.AUDIT.1(Y.ARR1)
*    PROGRAM INTRBR.AUDIT
    $INSERT GLOBUS.BP I_COMMON
    $INSERT GLOBUS.BP I_ENQUIRY.COMMON
    $INSERT GLOBUS.BP I_EQUATE

    $INSERT JBL.BP I_F.ABL.H.MUL.PRM


    FN.ABL.H.MUL.PRM = "F.ABL.H.MUL.PRM"
    F.ABL.H.MUL.PRM = ""
    R.ABL.H.MUL.PRM = ""
    CALL OPF(FN.ABL.H.MUL.PRM,F.ABL.H.MUL.PRM)


    Y.FDATE=ENQ.SELECTION<4,1>
    Y.TDATE=ENQ.SELECTION<4,2>

*    Y.FDATE='20160214'
*    Y.TDATE='20160214'




    Y.DT1=RIGHT(Y.FDATE,2):"-":RIGHT(LEFT(Y.FDATE,6),2):"-":LEFT(Y.FDATE,4)
    Y.DT2=RIGHT(Y.TDATE,2):"-":RIGHT(LEFT(Y.TDATE,6),2):"-":LEFT(Y.TDATE,4)


*    CRT Y.FDATE
*    CRT Y.TDATE

*Y.FDATE='1501010000'
*Y.TDATE='1603030000'

    NO.OF.RECORDS = 0
    RET.CODE = ""
    Y.ARR1=''
    Y.SERIAL=''




    IF Y.FDATE EQ Y.TDATE THEN
        Y.FDATE1=RIGHT(Y.FDATE,6):"0000"
        Y.TDATE1=RIGHT(Y.TDATE,6):"9999"
        Y.DT="REPORT BASED ON : ":Y.DT1

    END

    ELSE IF Y.FDATE GT Y.TDATE THEN

        Y.FDATE1=RIGHT(Y.TDATE,6):"0000"
        Y.TDATE1=RIGHT(Y.FDATE,6):"9999"

        Y.DT="REPORT FROM ":Y.DT2:" TO ":Y.DT1


    END
    ELSE
        Y.FDATE1=RIGHT(Y.FDATE,6):"0000"
        Y.TDATE1=RIGHT(Y.TDATE,6):"9999"
        Y.DT="REPORT FROM ":Y.DT1:" TO ":Y.DT2
    END

    SEL.CMD = "SELECT " : FN.ABL.H.MUL.PRM :" WITH DATE.TIME GE ":Y.FDATE1:" AND DATE.TIME LE ":Y.TDATE1:" AND @ID EQ 'INTRBRCOMP'"

    CALL EB.READLIST(SEL.CMD,SEL.LIST,"",NO.OF.RECORDS,RET.CODE)

    IF NO.OF.RECORDS NE 0 THEN
        Y.ABL.H.MUL = "SYSTEM"
        CALL F.READ(FN.ABL.H.MUL.PRM,Y.ABL.H.MUL,R.ABL.H.MUL.PRM,FN.ABL.H.MUL.PRM,Y.ERR)

        IF R.ABL.H.MUL.PRM NE '' THEN
            Y.SERIAL=1
            Y.CURR.NO = R.ABL.H.MUL.PRM<MPM.CURR.NO>
            Y.INPUTTER = R.ABL.H.MUL.PRM<MPM.INPUTTER>
            Y.INPUTTER=FIELD(Y.INPUTTER,"_",2,1)
            Y.DATE.TIME = R.ABL.H.MUL.PRM<MPM.DATE.TIME>

            Y.DATE=LEFT(Y.DATE.TIME,6)
            Y.DATE2="20":Y.DATE
            Y.YEAR2=LEFT(Y.DATE2,4)
            Y.MONTH2=LEFT(RIGHT(Y.DATE2,4),2)
            Y.DAY2=RIGHT(Y.DATE2,2)
            Y.DATE2=''
            Y.DATE2=Y.DAY2:"-":Y.MONTH2:"-":Y.YEAR2




            Y.TIME=RIGHT(Y.DATE.TIME,4)
            Y.TIME2=LEFT(Y.TIME,2):":":RIGHT(Y.TIME,2)

            Y.AUTHORISER = R.ABL.H.MUL.PRM<MPM.AUTHORISER>
            Y.AUTHORISER=FIELD(Y.AUTHORISER,"_",2,1)

*    Y.ARR1<-1> = Y.CURR.NO:"*":Y.INPUTTER:"*":Y.DATE2:"*":Y.TIME2:"*":Y.AUTHORISER
*    Y.ARR1 = Y.SERIAL:"*":Y.INPUTTER:"*":Y.DATE2:"*":Y.TIME2:"*":Y.AUTHORISER:"*":Y.CURR.NO

            Y.ARR1<-1> = Y.SERIAL:"*":Y.INPUTTER:"*":Y.DATE2:"*":Y.TIME2:"*":Y.AUTHORISER:"*":Y.CURR.NO:"*":Y.DT
        END
    END
    ELSE
    END

*    CRT Y.ARR1

    FN.ABL.H.MUL.PRM.HIS = "F.ABL.H.MUL.PRM$HIS"
    F.ABL.H.MUL.PRM.HIS = ""
    R.ABL.H.MUL.PRM.HIS = ""
    CALL OPF(FN.ABL.H.MUL.PRM.HIS,F.ABL.H.MUL.PRM.HIS)
    NO.OF.RECORDS1=0
    RET.CODE1=""

    SEL.CMD1="SELECT " : FN.ABL.H.MUL.PRM.HIS :" WITH DATE.TIME GE ":Y.FDATE1:" AND DATE.TIME LE ":Y.TDATE1:" AND @ID LIKE '...SYSTEM...' BY-DSND CURR.NO"

    CALL EB.READLIST(SEL.CMD1,SEL.LIST1,"",NO.OF.RECORDS1,RET.CODE1)
*    CRT SEL.LIST1
*    FOR C = 1 TO 9

    IF Y.SERIAL=1 THEN
        Y.SERIAL1=2
    END
    ELSE
        Y.SERIAL1=1
    END




    LOOP
        REMOVE Y.ABL.H.MUL.PRM.ID FROM SEL.LIST1 SETTING POS
    WHILE Y.ABL.H.MUL.PRM.ID : POS
        CALL F.READ(FN.ABL.H.MUL.PRM.HIS,Y.ABL.H.MUL.PRM.ID,R.ABL.H.MUL.PRM.HIS,FN.ABL.H.MUL.PRM.HIS,Y.ERR1)
        Y.CURR.NO1 = R.ABL.H.MUL.PRM.HIS<MPM.CURR.NO>
        Y.INPUTTER1 = R.ABL.H.MUL.PRM.HIS<MPM.INPUTTER>
        Y.INPUTTER1=FIELD(Y.INPUTTER1,"_",2,1)
        Y.DATE.TIME1 = R.ABL.H.MUL.PRM.HIS<MPM.DATE.TIME>
        Y.DATE1=LEFT(Y.DATE.TIME1,6)
        Y.DATE1="20":Y.DATE1

        Y.YEAR1=LEFT(Y.DATE1,4)
        Y.MONTH1=LEFT(RIGHT(Y.DATE1,4),2)
        Y.DAY1=RIGHT(Y.DATE1,2)
        Y.DATE1=''
        Y.DATE1=Y.DAY1:"-":Y.MONTH1:"-":Y.YEAR1


        Y.TIME1=RIGHT(Y.DATE.TIME1,4)
        Y.TIME11=LEFT(Y.TIME1,2):":":RIGHT(Y.TIME1,2)
        Y.AUTHORISER1 = R.ABL.H.MUL.PRM.HIS<MPM.AUTHORISER>
        Y.AUTHORISER1=FIELD(Y.AUTHORISER1,"_",2,1)
        Y.ARR1<-1> = Y.SERIAL1:"*":Y.INPUTTER1:"*":Y.DATE1:"*":Y.TIME11:"*":Y.AUTHORISER1:"*":Y.CURR.NO1:"*":Y.DT
        Y.SERIAL1 = Y.SERIAL1 + 1

*        Y.ARR1<-1> = Y.CURR.NO1:"*":Y.INPUTTER1:"*":Y.DATE1:"*":Y.TIME11:"*":Y.AUTHORISER1
*        CRT Y.ARR2
*    NEXT C
    REPEAT

*CRT Y.ARR1

    RETURN
END
