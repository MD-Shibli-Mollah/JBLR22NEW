!PROGRAM JBL.ATM.CARD.WRT.BAT
    SUBROUTINE JBL.ATM.CARD.WRT.BAT

    $INSERT GLOBUS.BP I_COMMON
    $INSERT GLOBUS.BP I_EQUATE
    $INSERT BP I_F.JBL.CARD.BATCH.CRE
    $INSERT BP I_F.ATM.CARD.MGT

    FN.ATM="F.EB.ATM.CARD.MGT"
    F.ATM=""
    FN.BAT.NAU="F.JBL.CARD.BATCH.CRE$NAU"
    F.BAT.NAU=""

    CALL OPF(FN.ATM,F.ATM)
    CALL OPF(FN.BAT.NAU,F.BAT.NAU)

    Y.BATCH.ID=R.NEW(EB.ATM19.ATTRIBUTE1)

    Y.REQ.ID=ID.NEW

    CALL F.READ(FN.BAT.NAU,Y.BATCH.ID,REC.BATCH,F.BAT.NAU,ERR.BATCH)
    IF DCOUNT(REC.BATCH<CARD.BAT.REQUEST.ID>,@VM) EQ 0 THEN
        REC.BATCH<CARD.BAT.REQUEST.ID>=Y.REQ.ID
    END
    ELSE
        REC.BATCH<CARD.BAT.REQUEST.ID>=REC.BATCH<CARD.BAT.REQUEST.ID>:@VM:Y.REQ.ID
    END
!WRITE REC.BATCH TO F.CHQ.BATCH,Y.BATCH.ID
    CALL F.WRITE(FN.BAT.NAU,Y.BATCH.ID,REC.BATCH)


    RETURN

END
