! PROGRAM ATM.ACCT.CUS.INFO
    SUBROUTINE ATM.ACCT.CUS.INFO(Y.RETURN)
    $INSERT GLOBUS.BP I_COMMON
    $INSERT GLOBUS.BP I_EQUATE
    $INSERT GLOBUS.BP I_ENQUIRY.COMMON
    $INSERT GLOBUS.BP I_F.COMPANY
    $INSERT GLOBUS.BP I_F.ACCOUNT
    $INSERT GLOBUS.BP I_F.CUSTOMER

    GOSUB INIT
    GOSUB OPENFILE
    GOSUB PROCESS
    RETURN

*---------
INIT:
*------
    FN.COMPANY='F.COMPANY'
    F.COMPANY=''
    FN.ACCOUNT = 'F.ACCOUNT'
    F.ACCOUNT = ''
    FN.CUSTOMER = 'F.CUSTOMER'
    F.CUSTOMER = ''
    RETURN
*---------
OPENFILE:
*---------
    CALL OPF(FN.COMPANY,F.COMPANY)
    CALL OPF(FN.ACCOUNT,F.ACCOUNT)
    CALL OPF(FN.CUSTOMER,F.CUSTOMER)
    LOCATE "ACCOUNT.NUMBER" IN ENQ.SELECTION<2,1> SETTING AC.POS THEN
        Y.ACCOUNT = ENQ.SELECTION<4,AC.POS>
    END
    RETURN
*---------

PROCESS:
    CALL F.READ(FN.ACCOUNT,Y.ACCOUNT,R.AC.REC,F.ACCOUNT,Y.ERR)
    Y.TITLE=R.AC.REC<AC.ACCOUNT.TITLE.1>
    Y.BR.CODE=R.AC.REC<AC.CO.CODE>
    Y.CUSTOMER.ID=R.AC.REC<AC.CUSTOMER>
    IF Y.CUSTOMER.ID NE "" THEN
        CALL F.READ(FN.CUSTOMER,Y.CUSTOMER.ID,R.CUS.REC,F.CUSTOMER,Y.ERR1)
        Y.DOB=R.CUS.REC<EB.CUS.DATE.OF.BIRTH>
        CALL GET.LOC.REF("CUSTOMER","FATHER.NAME",Y.POSF)
        Y.FA.NAME=R.CUS.REC<EB.CUS.LOCAL.REF,Y.POSF>
        CALL GET.LOC.REF("CUSTOMER","MOTHER.NAME",Y.POSM)
        Y.MO.NAME=R.CUS.REC<EB.CUS.LOCAL.REF,Y.POSM>
        CALL F.READ(FN.COMPANY,Y.BR.CODE,R.COM.REC,F.COMPANY,Y.ERR2)
        Y.BR.NAME=R.COM.REC<EB.COM.COMPANY.NAME>
    END
    Y.RETURN<-1>=Y.ACCOUNT:"*":Y.TITLE:"*":Y.FA.NAME:"*":Y.MO.NAME:"*":Y.DOB:"*":Y.BR.CODE:"*":Y.BR.NAME
END

