*******Develop By: Robiul (JBL)********
*****Date: 20 MAR 2017 ***************
*-----------------------------------------------------------------------------
* <Rating>359</Rating>
*-----------------------------------------------------------------------------
    SUBROUTINE ATM.REC.ISS.PEN.LIST
!PROGRAM ATM.REC.ISS.PEN.LIST

    $INSERT GLOBUS.BP I_COMMON
    $INSERT GLOBUS.BP I_EQUATE
    $INSERT GLOBUS.BP I_ENQUIRY.COMMON
    $INSERT GLOBUS.BP I_F.ACCOUNT
    $INSERT GLOBUS.BP I_F.CUSTOMER
    $INSERT BP I_F.ATM.CARD.MGT

    FN.AC = "F.ACCOUNT"
    F.AC = ""
    FN.ATM="F.EB.ATM.CARD.MGT"
    F.ATM=""
    FN.CUS="F.CUSTOMER"
    F.CUS=""
    Y.COMPANY= ""
    Y.DATE=""
    Y.CATEGORY=""
    Y.CARD.TYPE=""


    CALL OPF(FN.AC,F.AC)
    CALL OPF(FN.CUS,F.CUS)
    CALL OPF(FN.ATM,F.ATM)



    Y.ACCOUNT  = O.DATA
    CALL F.READ(FN.AC,Y.ACCOUNT,R.AC.REC,F.AC,Y.ERR)
    Y.ACCT.CATEGORY=R.AC.REC<AC.CATEGORY>
    Y.ACCOUNT.NAME1 = R.AC.REC<AC.ACCOUNT.TITLE.1>
    Y.ACCOUNT.NAME2 = R.AC.REC<AC.ACCOUNT.TITLE.2>
    Y.NAME=Y.ACCOUNT.NAME1:Y.ACCOUNT.NAME2
    Y.CUSTOMER = R.AC.REC<AC.CUSTOMER>

    CALL F.READ(FN.CUS,Y.CUSTOMER,R.CUS.REC,F.CUS,Y.ERR)

    Y.SEX=R.CUS.REC<EB.CUS.GENDER>
    Y.SEX=LEFT(Y.SEX,1)
    Y.TITLE = R.CUS.REC<EB.CUS.TITLE>
    IF Y.TITLE EQ "MR" THEN
        Y.TIT=1
    END
    ELSE  IF Y.TITLE EQ "MRS" THEN
        Y.TIT=2
    END
    ELSE IF Y.TITLE EQ "MS" THEN
        Y.TIT=3
    END
    IF Y.TITLE EQ "DR" THEN
        Y.TIT=4
    END
    ELSE  IF Y.TITLE EQ "MISS" THEN
        Y.TIT=5
    END
    ELSE IF Y.TITLE EQ "REV" THEN
        Y.TIT=6
    END
    CALL GET.LOC.REF('CUSTOMER','CUS.COMU.ADD',Y.COMU.ADD)
    CALL GET.LOC.REF('CUSTOMER','CUS.COMU.VILL',Y.COMU.VILL)
    CALL GET.LOC.REF('CUSTOMER','CUS.COMU.PO',Y.COMU.PO)
    CALL GET.LOC.REF('CUSTOMER','CUS.COMU.UPZ',Y.COMU.UPZ)
    CALL GET.LOC.REF('CUSTOMER','CUS.COMU.DIST',Y.COMU.DIST)
    CALL GET.LOC.REF('CUSTOMER','FATHER.NAME',Y.FATHER.NAME)
    CALL GET.LOC.REF('CUSTOMER','MOTHER.NAME',Y.MOTHER.NAME)


!Y.LATFIO=R.ATM.REC<EB.ATM19.CARD.NAME>
    IF Y.ACCT.CATEGORY EQ 1001 OR Y.ACCT.CATEGORY EQ 1002 OR Y.ACCT.CATEGORY EQ 1003 THEN
        Y.ACCOUNTTP=20
    END
    IF Y.ACCT.CATEGORY EQ 6001 OR Y.ACCT.CATEGORY EQ 6002 OR Y.ACCT.CATEGORY EQ 6003 OR Y.ACCT.CATEGORY EQ 6004 OR Y.ACCT.CATEGORY EQ 6006 OR Y.ACCT.CATEGORY EQ 6007 OR Y.ACCT.CATEGORY EQ 6009 OR Y.ACCT.CATEGORY EQ 6012 OR Y.ACCT.CATEGORY EQ 6013 OR Y.ACCT.CATEGORY EQ 6014 OR Y.ACCT.CATEGORY EQ 6018 OR Y.ACCT.CATEGORY EQ 6019 OR Y.ACCT.CATEGORY EQ 6024 OR Y.ACCT.CATEGORY EQ 6025 THEN
        Y.ACCOUNTTP=19
    END


    Y.ACCTSTAT=3
    Y.ADDRESS=R.CUS.REC<EB.CUS.STREET>:" ":R.CUS.REC<EB.CUS.TOWN.COUNTRY>
    Y.ADDRESS=SUBSTRINGS(Y.ADDRESS,1,79)

    Y.CORADDRESS=R.CUS.REC<EB.CUS.LOCAL.REF,Y.COMU.ADD>:" ":R.CUS.REC<EB.CUS.LOCAL.REF,Y.COMU.VILL> :" ":R.CUS.REC<EB.CUS.LOCAL.REF,Y.COMU.PO>:" ":R.CUS.REC<EB.CUS.LOCAL.REF,Y.COMU.UPZ>: " ": R.CUS.REC<EB.CUS.LOCAL.REF,Y.COMU.DIST>
    Y.CORADDRESS=SUBSTRINGS(Y.CORADDRESS,1,79)
    Y.CELLPHONE=R.CUS.REC<EB.CUS.SMS.1>
    Y.CELLPHONE=Y.CELLPHONE<1,1>
    IF LEN(Y.CELLPHONE) GE 11 THEN
        Y.CELLPHONE=RIGHT(Y.CELLPHONE,10)
        Y.CELLPHONE="880":"(":LEFT(Y.CELLPHONE,5):")":RIGHT(Y.CELLPHONE,5)
    END

    Y.CLIENTPRPOP="<prop ID='MOTHERNAME' ValStr=":DQUOTE(DQUOTE(R.CUS.REC<EB.CUS.LOCAL.REF,Y.MOTHER.NAME>)):"/> <prop ID='FATHERNAME' ValStr=":DQUOTE(DQUOTE(R.CUS.REC<EB.CUS.LOCAL.REF,Y.FATHER.NAME>)):"/>"
    Y.BIRTHDAY=R.CUS.REC<EB.CUS.DATE.OF.BIRTH>
    D=ICONV(Y.BIRTHDAY, 'D4')
    Y.BIRTHDAY= OCONV(D, 'DD'):"/":LEFT(OCONV(D, 'DMA'),3):"/":OCONV(D,'DY')

    O.DATA=Y.NAME:"|":Y.SEX:"|":Y.TIT:"|":Y.ACCOUNTTP:"|":Y.ACCTSTAT:"|":Y.ADDRESS:"|":Y.CORADDRESS:"|":Y.CELLPHONE:"|":Y.CLIENTPRPOP:"|":Y.BIRTHDAY
    O.DATA=UPCASE(O.DATA)
    RETURN
END
