**********************************************************************************
* ROUTINE : USER.REV.LIST
* REASON : RETURN FOR NOFILE ENQUIRY WHICH CONTAINS REVERSED OR DELETED USER LIST
* REQ : Abu Hena Mostofa Zamal (FAGM)
* DEVELOPED BY : ALIN BOBY
* DATE : 20160313
**********************************************************************************

    SUBROUTINE USER.REV.LIST(Y.ARR1)
**    PROGRAM USER.REV.LIST
    $INSERT GLOBUS.BP I_COMMON
    $INSERT GLOBUS.BP I_EQUATE
    $INSERT GLOBUS.BP I_F.USER
    $INSERT GLOBUS.BP I_ENQUIRY.COMMON
    GOSUB STEP1
    GOSUB STEP2
    GOSUB STEP3
    RETURN

STEP1:

*    DEBUG
    FN.USER='F.USER'
    F.USER=''

    FN.USER.HIS='F.USER$HIS'
    F.USER.HIS=''
**    Y.SDATE='20100101'
**    Y.EDATE='20160313'
    Y.BR.CODE=''
    Y.SIGN.NAME=''
    Y.USER.NAME=''
    Y.REV.DATE=''
    Y.INP=''
    Y.AUTH=''
    Y.SL=0

*!DEBUG
*    LOCATE "CREATION.DATE" IN ENQ.SELECTION<2,1> SETTING CLS.ENQ.POS THEN
*        Y.START.DATE =LEFT(ENQ.SELECTION<4,CLS.ENQ.POS>,8)
*        Y.END.DATE =RIGHT(ENQ.SELECTION<4,CLS.ENQ.POS>,8)
*        Y.DATE.OPT=ENQ.SELECTION<3,CLS.ENQ.POS>
*    END

    Y.SDATE=ENQ.SELECTION<4,1>
    Y.EDATE=ENQ.SELECTION<4,2>


    Y.DT1=RIGHT(Y.SDATE,2):"-":RIGHT(LEFT(Y.SDATE,6),2):"-":LEFT(Y.SDATE,4)
    Y.DT2=RIGHT(Y.EDATE,2):"-":RIGHT(LEFT(Y.EDATE,6),2):"-":LEFT(Y.EDATE,4)


    IF Y.SDATE EQ Y.EDATE THEN
        Y.DT="REPORT BASED ON : ":Y.DT1
    END

    ELSE IF Y.SDATE GT Y.EDATE THEN
        Y.DT="REPORT FROM ":Y.DT2:" TO ":Y.DT1
        Y.DATE1=Y.SDATE
        Y.SDATE=Y.EDATE
        Y.EDATE=Y.DATE1
    END

    ELSE

        Y.DT="REPORT FROM ":Y.DT1:" TO ":Y.DT2
    END



    RETURN

STEP2:
    CALL OPF(FN.USER.HIS,F.USER.HIS)
    CALL OPF(FN.USER,F.USER)
    RETURN

STEP3:
*! DEBUG

    SEL.CMD='SELECT ':FN.USER.HIS:' WITH RECORD.STATUS EQ REVE'
    CALL EB.READLIST(SEL.CMD,SEL.LIST,'',NO.OF.REC,ERR)

*CRT SEL.LIST

    LOOP
        REMOVE Y.USER.ID FROM SEL.LIST SETTING POS
    WHILE Y.USER.ID:POS
        CALL F.READ(FN.USER.HIS,Y.USER.ID,R.USER.HIS,F.USER.HIS,ERR.USER)
        Y.DATE='20':LEFT(R.USER.HIS<EB.USE.DATE.TIME>,6)
        IF Y.DATE>=Y.SDATE AND Y.DATE<=Y.EDATE THEN
            Y.USER.ID1=FIELD(Y.USER.ID,';',1,1)
            SEL.CMD1='SELECT ':FN.USER:' WITH @ID EQ ':Y.USER.ID1
            CALL EB.READLIST(SEL.CMD1,SEL.LIST1,'',NO.OF.REC,ERR1)


            IF SEL.LIST1 EQ '' THEN
                Y.SL = Y.SL+1
                Y.BR.CODE=R.USER.HIS<EB.USE.COMPANY.RESTR>
                Y.SIGN.NAME=R.USER.HIS<EB.USE.SIGN.ON.NAME>
                Y.USER.NAME=R.USER.HIS<EB.USE.USER.NAME>
                Y.REV.DATE=Y.DATE
                Y.REV.TIME=LEFT(RIGHT(R.USER.HIS<EB.USE.DATE.TIME>,4),2):':':RIGHT(R.USER.HIS<EB.USE.DATE.TIME>,2)
                Y.INP=R.USER.HIS<EB.USE.INPUTTER>
                Y.INP1=FIELD(Y.INP,"_",2,1)
                Y.AUTH=R.USER.HIS<EB.USE.AUTHORISER>
                Y.AUTH1=FIELD(Y.AUTH,"_",2,1)
*!        PRINT Y.BR.CODE:'*':Y.SIGN.NAME:'*':Y.USER.NAME:'*':Y.REV.DATE:'*':Y.REV.TIME:'*':Y.INP:'*':Y.AUTH:'*':Y.DT
*                CRT Y.USER.ID1:'*':Y.BR.CODE:'*':Y.SIGN.NAME:'*':Y.USER.NAME:'*':Y.REV.DATE:'*':Y.REV.TIME:'*':Y.INP:'*':Y.AUTH:'*':Y.DT
                Y.ARR1<-1>= Y.BR.CODE:'*':Y.SIGN.NAME:'*':Y.USER.NAME:'*':Y.REV.TIME:'*':Y.REV.DATE:'*':Y.INP1:'*':Y.AUTH1:'*':Y.SL:'*':Y.DT
            END
        END
    REPEAT

**    CRT Y.ARR1
    RETURN
END
