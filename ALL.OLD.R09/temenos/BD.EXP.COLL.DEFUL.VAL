*-----------------------------------------------------------------------------
* <Rating>-40</Rating>
*-----------------------------------------------------------------------------
    SUBROUTINE BD.EXP.COLL.DEFUL.VAL
*----------------------------------------------------------------------------
*displays the advse ref no when the record opend in a particular format
*----------------------------------------------------------------------------
    $INSERT GLOBUS.BP I_COMMON
    $INSERT GLOBUS.BP I_EQUATE
    $INSERT GLOBUS.BP I_F.LETTER.OF.CREDIT
    $INSERT GLOBUS.BP I_F.DRAWINGS
    $INSERT GLOBUS.BP I_F.COMPANY

    GOSUB INITIALISE
    GOSUB OPENFILES
    GOSUB CHECK.REFNO
    RETURN

INITIALISE:

    FN.LETTER.OF.CREDIT="F.LETTER.OF.CREDIT"
    F.LETTER.OF.CREDIT=""
    FN.DRAWINGS="F.DRAWINGS"
    F.DRAWINGS=""

    RETURN

OPENFILES:
    CALL OPF(FN.LETTER.OF.CREDIT,F.LETTER.OF.CREDIT)
    CALL OPF(FN.DRAWINGS,F.DRAWINGS)
    RETURN

CHECK.REFNO:
!DEBUG
    GOSUB GET.LOC.REF.POS
    Y.DR.ID =ID.NEW
    Y.LC.ID = Y.DR.ID[1,12]

    CALL F.READ(FN.LETTER.OF.CREDIT,Y.LC.ID,R.LETTER.OF.CREDIT,F.LETTER.OF.CREDIT,Y.ERR)
    Y.EXPORT.LCNO = R.LETTER.OF.CREDIT<TF.LC.ISS.BANK.REF>
    Y.LC.CONTNO = R.LETTER.OF.CREDIT<TF.LC.LOCAL.REF><1,Y.CONTNO.POS>
    Y.LC.JOBNO = R.LETTER.OF.CREDIT<TF.LC.LOCAL.REF><1,Y.JOBNO.POS>
    Y.BEN.CUSNO = R.LETTER.OF.CREDIT<TF.LC.BENEFICIARY.CUSTNO>
    Y.LC.BEN.NAME = R.LETTER.OF.CREDIT<TF.LC.BENEFICIARY>
    Y.LC.APP.NAME = R.LETTER.OF.CREDIT<TF.LC.APPLICANT>
    Y.LC.TENOR = R.LETTER.OF.CREDIT<TF.LC.LOCAL.REF><1,Y.DTENOR.POS>
    R.NEW(TF.DR.DRAW.CURRENCY) = R.LETTER.OF.CREDIT<TF.LC.LC.CURRENCY>
    R.NEW(TF.DR.LOCAL.REF)<1,Y.DEXPLCNO.POS>  = Y.EXPORT.LCNO
    R.NEW(TF.DR.LOCAL.REF)<1,Y.DCONTNO.POS> = Y.LC.CONTNO
    R.NEW(TF.DR.LOCAL.REF)<1,Y.DJOBNO.POS> = Y.LC.JOBNO
    R.NEW(TF.DR.LOCAL.REF)<1,Y.DBENCUS.POS>  = Y.BEN.CUSNO
    R.NEW(TF.DR.LOCAL.REF)<1,Y.DEXPNAME.POS> = EREPLACE(Y.LC.BEN.NAME,VM,SM)
    R.NEW(TF.DR.LOCAL.REF)<1,Y.DIMPNAME.POS> = EREPLACE(Y.LC.APP.NAME,VM,SM)
    R.NEW(TF.DR.LOCAL.REF)<1,Y.DTENOR.POS> = Y.LC.TENOR
    RETURN

GET.LOC.REF.POS:
    CALL GET.LOC.REF("LETTER.OF.CREDIT","JOB.NUMBER",Y.JOBNO.POS)
    CALL GET.LOC.REF("LETTER.OF.CREDIT","BTB.CONTRACT.NO",Y.CONTNO.POS)
    CALL GET.LOC.REF("DRAWINGS","EXPORT.LC.NO",Y.DEXPLCNO.POS)
    CALL GET.LOC.REF("DRAWINGS","BTB.CONTRACT.NO",Y.DCONTNO.POS)
    CALL GET.LOC.REF("DRAWINGS","JOB.NUMBER",Y.DJOBNO.POS)
    CALL GET.LOC.REF("DRAWINGS","APPL.CUST.NO",Y.DBENCUS.POS)
    CALL GET.LOC.REF("DRAWINGS","EXPORTER.NAME",Y.DEXPNAME.POS)
    CALL GET.LOC.REF("DRAWINGS","IMPORTER.NAME",Y.DIMPNAME.POS)
    CALL GET.LOC.REF("DRAWINGS","TENOR.DAYS",Y.DTENOR.POS)

    RETURN
END
