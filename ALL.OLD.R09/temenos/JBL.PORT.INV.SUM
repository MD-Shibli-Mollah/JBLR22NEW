!  PROGRAM JBL.PORT.INV.SUM
    SUBROUTINE JBL.PORT.INV.SUM(Y.RETURN)
    $INSERT GLOBUS.BP I_COMMON
    $INSERT GLOBUS.BP I_EQUATE
    $INSERT GLOBUS.BP I_ENQUIRY.COMMON
    $INSERT BP I_F.JBL.PORT.INVOICE.INFO
    $INSERT BP I_F.JBL.PORT.COUNTER.INFO

!DEBUG
    LOCATE "RECEIVING.DATE" IN ENQ.SELECTION<2,1> SETTING PROD.DATE THEN
        Y.STR.DAT = ENQ.SELECTION<4,PROD.DATE,1>
        Y.END.DAT = ENQ.SELECTION<4,PROD.DATE,2>
        IF Y.END.DAT EQ "" THEN
            Y.END.DAT=Y.STR.DAT
        END

    END

    LOCATE "COUNTER.ID" IN ENQ.SELECTION<2,1> SETTING REF.POS THEN
        Y.COUNTER= ENQ.SELECTION<4,REF.POS>
    END
    LOCATE "BOOTH" IN ENQ.SELECTION<2,1> SETTING REF.POS THEN
        Y.BOOTH= ENQ.SELECTION<4,REF.POS>
        Y.BOOTH=UPCASE(Y.BOOTH)
    END
    Y.CO.CODE =ID.COMPANY
    DAYS="C"
    CALL CDD("",Y.STR.DAT, Y.END.DAT,DAYS)

    Y.STR.JULD = ''


    FN.INVOICE.INFO = 'F.JBL.PORT.INVOICE.INFO'
    F.INVOICE.INFO =''

    FN.COUNTER.INFO = 'F.JBL.PORT.COUNTER.INFO'
    F.COUNTER.INFO =''
    Y.RETURN=""



    CALL OPF(FN.INVOICE.INFO,F.INVOICE.INFO )
    CALL OPF(FN.COUNTER.INFO,F.COUNTER.INFO )


!CALL JULDATE(Y.STR.DAT,Y.STR.JULD)
!CALL JULDATE(Y.END.DAT,Y.END.JULD)

    SEL.CCUN = "SELECT ": FN.COUNTER.INFO:"  WITH COUNTER.GROUP EQ ":Y.BOOTH
    CALL EB.READLIST(SEL.CCUN ,SEL.CU.LIST,F.COUNTER.INFO,NO.ID.COUNTER,CU.ERR)

    IF Y.COUNTER NE "" AND Y.BOOTH NE "" THEN
        LOCATE Y.COUNTER IN SEL.CU.LIST SETTING CU.POS THEN
            SEL.CU.LIST=Y.COUNTER
        END ELSE
            SEL.CU.LIST=0
        END
    END


    FOR COUNTER = 0 TO DAYS
        CALL JULDATE(Y.STR.DAT,Y.STR.JULD)
        Y.PC.REF = "PI":RIGHT(ID.COMPANY,4):RIGHT(Y.STR.JULD,5)

        SEL.CMD = "SELECT ": FN.INVOICE.INFO:"  WITH @ID LIKE " :Y.PC.REF:"..."
!SEL.CMD = "SELECT ": FN.INVOICE.INFO:"  WITH @ID LIKE " :Y.PC.REF:"... AND CO.CODE EQ ":ID.COMPANY

        CALL EB.READLIST(SEL.CMD,SEL.PI.LIST,F.INVOICE.INFO,NO.ID,CH.ERR)

        LOOP
            REMOVE Y.PI.ID FROM SEL.PI.LIST SETTING POS
        WHILE Y.PI.ID:POS
            CALL F.READ(FN.INVOICE.INFO,Y.PI.ID,R.PI,F.INVOICE.INFO,Y.CH.ERR)

            Y.PI.CO.CODE = R.PI<PORT.INV.CO.CODE>
!IF Y.CO.CODE  EQ Y.PI.CO.CODE
            Y.TEM=""
            IF Y.BOOTH NE "" AND NO.ID.COUNTER NE 0 THEN

                LOCATE R.PI<PORT.INV.COUNTER.ID> IN SEL.CU.LIST SETTING CU.POS THEN
                    Y.TEM=Y.PI.ID
                END

            END ELSE

                IF  Y.COUNTER NE "" AND Y.COUNTER EQ R.PI<PORT.INV.COUNTER.ID> THEN
                    Y.TEM=Y.PI.ID
                END
                ELSE IF Y.COUNTER EQ "" THEN
                    Y.TEM=Y.PI.ID

                END


            END

            IF Y.TEM NE "" THEN

                IF LEN(R.PI<PORT.INV.COUNTER.ID>) EQ 1 THEN
                    Y.CUN.ZERO="0":R.PI<PORT.INV.COUNTER.ID>
                END ELSE
                    Y.CUN.ZERO=R.PI<PORT.INV.COUNTER.ID>
                END
                Y.TEM=R.PI<PORT.INV.RECEIVING.DATE>:"*":Y.CUN.ZERO:"*":R.PI<PORT.INV.CPANO>:"*":Y.TEM
                IF (R.PI<PORT.INV.TRANSACTION.TYPE> NE "DAAMOUNT") THEN
                    Y.RETURN<-1>=Y.TEM
                END
            END
        REPEAT
        CALL CDT("",Y.STR.DAT,"+1C")
    NEXT COUNTER
    Y.RETURN=SORT(Y.RETURN)
    RETURN
