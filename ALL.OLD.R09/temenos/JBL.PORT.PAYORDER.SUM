!PROGRAM JBL.PORT.PAYORDER.SUM
    SUBROUTINE JBL.PORT.PAYORDER.SUM(Y.RETURN)
    $INSERT GLOBUS.BP I_COMMON
    $INSERT GLOBUS.BP I_EQUATE
    $INSERT GLOBUS.BP I_ENQUIRY.COMMON
    $INSERT BP I_F.JBL.PORT.PAYORDER.INFO
    $INSERT BP I_F.JBL.PORT.COUNTER.INFO

    LOCATE "RECEIVING.DATE" IN ENQ.SELECTION<2,1> SETTING PROD.DATE THEN
        Y.STR.DAT = ENQ.SELECTION<4,PROD.DATE,1>
        Y.END.DAT = ENQ.SELECTION<4,PROD.DATE,2>
        IF Y.END.DAT EQ "" THEN
            Y.END.DAT=Y.STR.DAT
        END

    END

    LOCATE "COUNTER.ID" IN ENQ.SELECTION<2,1> SETTING REF.POS THEN
        Y.COUNTER= ENQ.SELECTION<4,REF.POS>
    END
    LOCATE "BOOTH" IN ENQ.SELECTION<2,1> SETTING REF.POS THEN
        Y.BOOTH= ENQ.SELECTION<4,REF.POS>
        Y.BOOTH=UPCASE(Y.BOOTH)
    END
    Y.CO.CODE =ID.COMPANY
    DAYS="C"
    CALL CDD("",Y.STR.DAT, Y.END.DAT,DAYS)

    Y.STR.JULD = ''


    FN.PAYORDER.INFO = 'F.JBL.PORT.PAYORDER.INFO'
    F.PAYORDER.INFO =''
    FN.COUNTER.INFO = 'F.JBL.PORT.COUNTER.INFO'
    F.COUNTER.INFO =''
    Y.RETURN=""

    CALL OPF(FN.PAYORDER.INFO,F.PAYORDER.INFO )
    CALL OPF(FN.COUNTER.INFO,F.COUNTER.INFO )

!CALL JULDATE(Y.STR.DAT,Y.STR.JULD)
!CALL JULDATE(Y.END.DAT,Y.END.JULD)

    SEL.CCUN = "SELECT ": FN.COUNTER.INFO:"  WITH COUNTER.GROUP EQ ":Y.BOOTH
    CALL EB.READLIST(SEL.CCUN ,SEL.CU.LIST,F.COUNTER.INFO,NO.ID.COUNTER,CU.ERR)

    IF Y.COUNTER NE "" AND Y.BOOTH NE "" THEN
        LOCATE Y.COUNTER IN SEL.CU.LIST SETTING CU.POS THEN
            SEL.CU.LIST=Y.COUNTER
        END ELSE
            SEL.CU.LIST=0
        END
    END

    FOR COUNTER = 0 TO DAYS
        CALL JULDATE(Y.STR.DAT,Y.STR.JULD)
        Y.PC.REF = "PA":RIGHT(ID.COMPANY,4):RIGHT(Y.STR.JULD,5)

        SEL.CMD = "SELECT ": FN.PAYORDER.INFO:"  WITH @ID LIKE " :Y.PC.REF:"..."


        CALL EB.READLIST(SEL.CMD,SEL.PI.LIST,F.PAYORDER.INFO,NO.ID,CH.ERR)

        LOOP
            REMOVE Y.PI.ID FROM SEL.PI.LIST SETTING POS
        WHILE Y.PI.ID:POS

            CALL F.READ(FN.PAYORDER.INFO,Y.PI.ID,R.PI,F.PAYORDER.INFO,Y.CH.ERR)

            Y.PI.CO.CODE = R.PI<PORT.PAYORD.CO.CODE>
            Y.TEM=""

            IF Y.BOOTH NE "" AND NO.ID.COUNTER NE 0 THEN

                LOCATE R.PI<PORT.PAYORD.COUNTER.ID> IN SEL.CU.LIST SETTING CU.POS THEN
                    Y.TEM=Y.PI.ID
                END

            END ELSE

                IF  Y.COUNTER NE "" AND Y.COUNTER EQ R.PI<PORT.PAYORD.COUNTER.ID>  THEN
                    Y.TEM=Y.PI.ID
                END
                ELSE IF Y.COUNTER EQ "" THEN
                    Y.TEM=Y.PI.ID

                END

            END
            IF Y.TEM NE "" THEN

                IF LEN(R.PI<PORT.PAYORD.COUNTER.ID>) EQ 1 THEN
                    Y.CUN.ZERO="0":R.PI<PORT.PAYORD.COUNTER.ID>
                END ELSE
                    Y.CUN.ZERO=R.PI<PORT.PAYORD.COUNTER.ID>
                END
                Y.BANK=R.PI<PORT.PAYORD.BankName>
                Y.RETURN<-1>=R.PI<PORT.PAYORD.RECEIVING.DATE>:"*":Y.BANK:"*":Y.CUN.ZERO:"*":Y.TEM
!  LOCATE Y.TEM IN Y.RETURN<1> BY 'AR' SETTING POS12 ELSE
!     INS Y.TEM BEFORE Y.RETURN<POS12>
!END
            END
        REPEAT
        CALL CDT("",Y.STR.DAT,"+1C")
    NEXT COUNTER
    Y.RETURN=SORT(Y.RETURN)

    RETURN

