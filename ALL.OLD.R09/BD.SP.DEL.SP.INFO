*-----------------------------------------------------------------------------
* <Rating>0</Rating>
*-----------------------------------------------------------------------------
*-----------------------------------------------------------------------------
*NAME:KH.MONWAR HOSSAIN.
*DATE:08-10-2017
*update by Alin Boby, Date: 17-07-2018
*-----------------------------------------------------------------------------
    SUBROUTINE BD.SP.DEL.SP.INFO
!PROGRAM DEL.CP.FT.SP.INFO
    $INSERT GLOBUS.BP I_EQUATE
    $INSERT GLOBUS.BP I_COMMON
    $INSERT SP.BP I_F.BD.H.SP.STOCK.ISSUE
    $INSERT SP.BP I_F.BD.H.SP.COUPON
    $INSERT GLOBUS.BP I_F.FUNDS.TRANSFER
    $INSERT GLOBUS.BP I_F.TELLER
    $INSERT SP.BP I_F.BD.H.SP.STOCK.BATCH


    FN.FT = 'F.FUNDS.TRANSFER'
    F.FT = ''
    FN.FT.SP.INFO ='F.FUNDS.TRANSFER.SP.INFO'
    F.FT.SP.INFO = ''
    FN.TT = 'F.TELLER'
    F.TT = ''
    FN.TT.SP.INFO = 'F.TELLER.SP.INFO'
    F.TT.SP.INFO = ''
    FN.SP.ISSUE.AUTH = 'F.BD.H.SP.STOCK.ISSUE$NAU'
    F.SP.ISSUE.AUTH = ''
    FN.STK.BCH='F.BD.H.SP.STOCK.BATCH'
    F.STK.BCH=''

    CALL OPF(FN.SP.ISSUE.AUTH,F.SP.ISSUE.AUTH)
    CALL OPF(FN.FT,F.FT)
    CALL OPF(FN.TT,F.TT)
*   CALL OPF(FN.TT.SP.INFO,F.TT.SP.INFO)
*   CALL OPF(FN.FT.SP.INO,F.FT.SP.INFO)
    CALL OPF(FN.STK.BCH,F.STK.BCH)


    Y.VER.ID=APPLICATION:PGM.VERSION
    IF Y.VER.ID EQ "BD.H.SP.STOCK.ISSUE,SALES" AND V$FUNCTION EQ 'A' THEN
        Y.SP.ISS.ID = ID.NEW
        CALL F.READ(FN.SP.ISSUE.AUTH,Y.SP.ISS.ID,R.SP,F.SP.ISSUE.AUTH,ERR.SP)
        Y.TYPE = R.SP<SP.STK.FT.OR.TT>
        IF Y.TYPE EQ 'TT' THEN
            CALL F.READ(FN.TT.SP.INFO,Y.SP.ISS.ID,R.INFO,F.TT.SP.INFO,TT.ERR)
            IF R.INFO THEN
                CALL F.DELETE(FN.TT.SP.INFO,Y.SP.ISS.ID)
            END
        END
        ELSE
            CALL F.READ(FN.FT.SP.INFO,Y.SP.ISS.ID,R.FT.INFO,F.FT.SP.INFO,FT.ERR)
            IF R.FT.INFO THEN
                CALL F.DELETE(FN.FT.SP.INFO,Y.SP.ISS.ID)
            END
        END
    END

    IF Y.VER.ID EQ "BD.H.SP.STOCK.ISSUE,REIMAUTH" AND V$FUNCTION EQ 'A' THEN
        Y.SP.ISS.ID = ID.NEW
*  CALL F.READ(FN.SP.ISSUE.AUTH,Y.SP.ISS.ID,R.SP,F.SP.ISSUE.AUTH,ERR.SP)

*  CALL F.READ(FN.TT.SP.INFO,Y.SP.ISS.ID,R.INFO,F.TT.SP.INFO,TT.ERR)
*  IF R.INFO THEN
*      CALL F.DELETE(FN.TT.SP.INFO,Y.SP.ISS.ID)
*  END

        CALL F.READ(FN.FT.SP.INFO,Y.SP.ISS.ID,R.FT.INFO,F.FT.SP.INFO,FT.ERR)
        IF R.FT.INFO THEN
            CALL F.DELETE(FN.FT.SP.INFO,Y.SP.ISS.ID)
        END

    END


    IF Y.VER.ID EQ "BD.H.SP.COUPON,REAUTH2" AND V$FUNCTION EQ 'A' THEN
        Y.SP.ISS.ID = ID.NEW
        CALL F.READ(FN.TT.SP.INFO,Y.SP.ISS.ID,R.INFO,F.TT.SP.INFO,TT.ERR)
        IF R.INFO THEN
            CALL F.DELETE(FN.TT.SP.INFO,Y.SP.ISS.ID)
        END

        CALL F.READ(FN.FT.SP.INFO,Y.SP.ISS.ID,R.FT.INFO,F.FT.SP.INFO,FT.ERR)
        IF R.FT.INFO THEN
            CALL F.DELETE(FN.FT.SP.INFO,Y.SP.ISS.ID)
        END
    END


    IF Y.VER.ID EQ "BD.H.SP.STOCK.BATCH,COM" AND V$FUNCTION EQ 'A' THEN
        Y.SP.ISS.ID = ID.NEW
        CALL F.READ(FN.FT.SP.INFO,Y.SP.ISS.ID,R.FT.INFO,F.FT.SP.INFO,FT.ERR)
        IF R.FT.INFO THEN
            CALL F.DELETE(FN.FT.SP.INFO,Y.SP.ISS.ID)
        END
    END


    IF Y.VER.ID EQ "FUNDS.TRANSFER,SP.COM" AND V$FUNCTION EQ 'A' THEN

        CALL GET.LOC.REF("FUNDS.TRANSFER","SP.INFO",Y.SP.POS)
        Y.SP.ID=R.NEW(FT.LOCAL.REF)<1,Y.SP.POS>

        CALL F.READ(FN.FT.SP.INFO,Y.SP.ID,R.FT.INFO,F.FT.SP.INFO,FT.ERR)
        IF R.FT.INFO THEN
            CALL F.DELETE(FN.FT.SP.INFO,Y.SP.ID)
        END
    END

    IF Y.VER.ID EQ "FUNDS.TRANSFER,SP.COM1" AND V$FUNCTION EQ 'A' THEN

        CALL GET.LOC.REF("FUNDS.TRANSFER","SP.INFO",Y.SP.POS)
        Y.SP.ID=R.NEW(FT.LOCAL.REF)<1,Y.SP.POS>

        CALL F.READ(FN.FT.SP.INFO,Y.SP.ID,R.FT.INFO,F.FT.SP.INFO,FT.ERR)
        IF R.FT.INFO THEN
            CALL F.DELETE(FN.FT.SP.INFO,Y.SP.ID)
        END
    END


    RETURN
END
