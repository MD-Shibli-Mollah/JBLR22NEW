*-----------------------------------------------------------------------------
* <Rating>-40</Rating>
*-----------------------------------------------------------------------------
    SUBROUTINE BD.BTB.LODG.DEFUL.VAL
!PROGRAM BD.BTB.LODG.DEFUL.VAL
*----------------------------------------------------------------------------
*displays the advse ref no when the record opend in a particular format
*----------------------------------------------------------------------------
    $INSERT I_COMMON
    $INSERT I_EQUATE
    $INSERT I_F.LETTER.OF.CREDIT
    $INSERT I_F.DRAWINGS
    $INSERT I_F.COMPANY

    GOSUB INITIALISE
    GOSUB OPENFILES
    GOSUB CHECK.REFNO
    RETURN

INITIALISE:

    FN.LETTER.OF.CREDIT="F.LETTER.OF.CREDIT"
    F.LETTER.OF.CREDIT=""
    R.LETTER.OF.CREDIT=""
    FN.DRAWINGS="F.DRAWINGS"
    F.DRAWINGS=""

    RETURN

OPENFILES:
    CALL OPF(FN.LETTER.OF.CREDIT,F.LETTER.OF.CREDIT)
    CALL OPF(FN.DRAWINGS,F.DRAWINGS)
    RETURN

CHECK.REFNO:
    GOSUB GET.LOC.REF.POS
    Y.DR.ID =ID.NEW
    Y.LC.ID = Y.DR.ID[1,12]
    CALL F.READ(FN.LETTER.OF.CREDIT,Y.LC.ID,R.LETTER.OF.CREDIT,F.LETTER.OF.CREDIT,Y.ERR)
    Y.APP.CUSNO = R.LETTER.OF.CREDIT<TF.LC.APPLICANT.CUSTNO>
    Y.LC.NO=R.LETTER.OF.CREDIT<TF.LC.OLD.LC.NUMBER>
    R.NEW(TF.DR.DRAW.CURRENCY) = R.LETTER.OF.CREDIT<TF.LC.LC.CURRENCY>
    R.NEW(TF.DR.LOCAL.REF)<1,Y.DAPPCUS.POS>  = Y.APP.CUSNO
    R.NEW(TF.DR.LOCAL.REF)<1,Y.DLCNO.POS>  = Y.LC.NO
    R.NEW(TF.DR.LOCAL.REF)<1,Y.DJOBNO.POS> = R.LETTER.OF.CREDIT<TF.LC.LOCAL.REF><1,Y.JOBNO.POS>
    R.NEW(TF.DR.LOCAL.REF)<1,Y.DLCAFNO.POS> = R.LETTER.OF.CREDIT<TF.LC.LOCAL.REF><1,Y.LCAFNO.POS>
    R.NEW(TF.DR.LOCAL.REF)<1,Y.DLCAFDT.POS> = R.LETTER.OF.CREDIT<TF.LC.LOCAL.REF><1,Y.LCAFDT.POS>
    Y.BEN.NAME=R.LETTER.OF.CREDIT<TF.LC.BENEFICIARY>
    Y.IMP.NAME = R.LETTER.OF.CREDIT<TF.LC.APPLICANT>
    R.NEW(TF.DR.LOCAL.REF)<1,Y.DEXPNAME.POS>=EREPLACE(Y.BEN.NAME,VM,SM)
    R.NEW(TF.DR.LOCAL.REF)<1,Y.DIMPNAME.POS>=EREPLACE(Y.IMP.NAME,VM,SM)

    RETURN
*-----------------------------------------------------------------------------
GET.LOC.REF.POS:
*--------------
    CALL GET.LOC.REF("LETTER.OF.CREDIT","JOB.NUMBER",Y.JOBNO.POS)
    CALL GET.LOC.REF("LETTER.OF.CREDIT","LCAF.NO",Y.LCAFNO.POS)
    CALL GET.LOC.REF("LETTER.OF.CREDIT","LCAF.DATE",Y.LCAFDT.POS)
    CALL GET.LOC.REF("DRAWINGS","APPL.CUST.NO",Y.DAPPCUS.POS)
    CALL GET.LOC.REF("DRAWINGS","LC.NO",Y.DLCNO.POS)
    CALL GET.LOC.REF("DRAWINGS","JOB.NUMBER",Y.DJOBNO.POS)
    CALL GET.LOC.REF("DRAWINGS","EXPORTER.NAME",Y.DEXPNAME.POS)
    CALL GET.LOC.REF("DRAWINGS","IMPORTER.NAME",Y.DIMPNAME.POS)
    CALL GET.LOC.REF("DRAWINGS","LCAF.NO",Y.DLCAFNO.POS)
    CALL GET.LOC.REF("DRAWINGS","LCAF.DATE",Y.DLCAFDT.POS)
    RETURN
END
