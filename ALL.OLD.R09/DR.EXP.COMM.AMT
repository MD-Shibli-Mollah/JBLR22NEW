*-----------------------------------------------------------------------------
* <Rating>-30</Rating>
*-----------------------------------------------------------------------------
    SUBROUTINE DR.EXP.COMM.AMT
    $INSERT I_COMMON
    $INSERT I_EQUATE
    $INSERT I_F.DRAWINGS
    $INCLUDE JBL.BP I_F.EXP.BD.TAX.COMM

    GOSUB INITIALIZE
    GOSUB CALCULATE

INITIALIZE:

    FN.LETTER.OF.CREDIT='FBNK.LETTER.OF.CREDIT'
    F.LETTER.OF.CREDIT=''
    CALL OPF(FN.LETTER.OF.CREDIT,F.LETTER.OF.CREDIT)
    FN.LETTER.OF.CREDIT1='FBNK.LETTER.OF.CREDIT$NAU'
    F.LETTER.OF.CREDIT1=''
    CALL OPF(FN.LETTER.OF.CREDIT1,F.LETTER.OF.CREDIT1)
    FN.EXP.BD.TAX.COMM='F.LC.EXP.BD.TAX.COMM'
    F.EXP.BD.TAX.COMM=''
    CALL OPF(FN.EXP.BD.TAX.COMM,F.EXP.BD.TAX.COMM)

    FN.DR = 'FBNK.DRAWINGS$NAU'
    F.DR = ''
    CALL OPF(FN.DR,F.DR)

    RETURN

CALCULATE:
    A = '' ; B= ''; C = ''
    GOSUB CALC.SRC.TAX.PERC.FLD
    SRC.PERCEN=R.NEW(TF.DR.LOCAL.REF)<1,SRC.TAX.PERC.FLD>

    CALL F.READ(FN.LETTER.OF.CREDIT1,ID.NEW,R.LC.REC,F.LETTER.OF.CREDIT1,LC.ERR)
    CALL F.READ(FN.DR,ID.NEW,R.DR.REC,F.DR,DR.ERR)

    LC.APP='EXP.SOURCE.TAX'
    Y.CHRG.CODE = R.DR.REC<TF.DR.CHARGE.CODE>
    Y.CHRG.CODE.CNT = DCOUNT(Y.CHRG.CODE,@VM)

    FOR I = 1 TO Y.CHRG.CODE.CNT
        CHRG.CDE=R.DR.REC<TF.DR.CHARGE.CODE,I>
        CHRG.AMT=R.DR.REC<TF.DR.CHARGE.AMOUNT,I>
        CALL F.READ(FN.EXP.BD.TAX.COMM,LC.APP,R.LC.APP,F.EXP.BD.TAX.COMM,B.ERR)

        FT.COM.TYP=R.LC.APP<LC.EXP51.FT.COMM.CODE>
        LOCATE CHRG.CDE IN FT.COM.TYP<1,1> SETTING POS THEN

            A=SRC.PERCEN/100
            B = CHRG.AMT * A
            R.NEW(TF.DR.LOCAL.REF)<1,SRC.TAX.AMT.FLD>=B

        END ELSE
            NULL
        END

    NEXT I

    RETURN

CALC.SRC.TAX.PERC.FLD:
    SRC.TAX.PERC='SOURCE.TAX.PERC'
    SRC.TAX.PERC.FLD=''
    CALL GET.LOC.REF('DRAWINGS',SRC.TAX.PERC,SRC.TAX.PERC.FLD)
    SRC.TAX.AMT='SOURCE.TAX.AMT'
    SRC.TAX.AMT.FLD=''
    CALL GET.LOC.REF('DRAWINGS',SRC.TAX.AMT,SRC.TAX.AMT.FLD)
    RETURN
